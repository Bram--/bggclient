<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BggClient.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">BggClient</a> &gt; <a href="index.source.html" class="el_package">org.audux.bgg</a> &gt; <span class="el_source">BggClient.kt</span></div><h1>BggClient.kt</h1><pre class="source lang-java linenums">/**
 * Copyright 2023 Bram Wijnands
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */
package org.audux.bgg

import com.fasterxml.jackson.databind.ObjectMapper
import io.github.aakira.napier.DebugAntilog
import io.github.aakira.napier.Napier
import io.ktor.client.HttpClient
import kotlinx.coroutines.runBlocking
import org.audux.bgg.data.common.ThingType
import org.audux.bgg.data.request.collection
import org.audux.bgg.module.BggKtorClient
import org.audux.bgg.module.BggXmlObjectMapper
import org.audux.bgg.module.appModule
import org.koin.core.component.KoinComponent
import org.koin.core.component.inject
import org.koin.core.context.startKoin
import org.koin.core.qualifier.named

<span class="nc" id="L31">class BggClient : KoinComponent {</span>
<span class="nc" id="L32">    internal val client: HttpClient by inject(named&lt;BggKtorClient&gt;())</span>
<span class="nc" id="L33">    internal val mapper: ObjectMapper by inject(named&lt;BggXmlObjectMapper&gt;())</span>

<span class="nc" id="L35">    init {</span>
<span class="nc" id="L36">        startKoin { modules(appModule) }</span>
<span class="nc" id="L37">    }</span>

    fun close() {
<span class="nc" id="L40">        client.close()</span>
<span class="nc" id="L41">    }</span>

    internal companion object {
        const val BASE_URL = &quot;https://boardgamegeek.com/xmlapi2&quot;

        const val PATH_COLLECTION = &quot;collection&quot;
        const val PATH_HOT = &quot;hot&quot;
        const val PATH_SEARCH = &quot;search&quot;
        const val PATH_THING = &quot;thing&quot;

        const val PARAM_BGG_RATING = &quot;bggrating&quot;
        const val PARAM_BRIEF = &quot;brief&quot;
        const val PARAM_COLLECTION_ID = &quot;collid&quot;
        const val PARAM_COMMENT = &quot;comment&quot;
        const val PARAM_COMMENTS = &quot;comments&quot;
        const val PARAM_EXACT = &quot;exact&quot;
        const val PARAM_EXCLUDE_SUBTYPE = &quot;excludesubtype&quot;
        const val PARAM_ID = &quot;id&quot;
        const val PARAM_HAS_PARTS = &quot;hasparts&quot;
        const val PARAM_MARKETPLACE = &quot;marketplace&quot;
        const val PARAM_MAX_PLAYS = &quot;maxplays&quot;
        const val PARAM_MINIMUM_PLAYS = &quot;minplays&quot;
        const val PARAM_MINIMUM_RATING = &quot;minrating&quot;
        const val PARAM_MINIMUM_BGG_RATING = &quot;minbggrating&quot;
        const val PARAM_MODIFIED_SINCE = &quot;modifiedsince&quot;
        const val PARAM_OWN = &quot;own&quot;
        const val PARAM_PAGE = &quot;page&quot;
        const val PARAM_PAGE_SIZE = &quot;pagesize&quot;
        const val PARAM_PLAYED = &quot;played&quot;
        const val PARAM_PRE_ORDERED = &quot;preordered&quot;
        const val PARAM_PREVIOUSLY_OWNED = &quot;prevowned&quot;
        const val PARAM_QUERY = &quot;query&quot;
        const val PARAM_RATED = &quot;rated&quot;
        const val PARAM_RATING = &quot;rating&quot;
        const val PARAM_RATING_COMMENTS = &quot;ratingcomments&quot;
        const val PARAM_SHOW_PRIVATE = &quot;showprivate&quot;
        const val PARAM_STATS = &quot;stats&quot;
        const val PARAM_SUBTYPE = &quot;subtype&quot;
        const val PARAM_TRADE = &quot;trade&quot;
        const val PARAM_TYPE = &quot;type&quot;
        const val PARAM_USERNAME = &quot;username&quot;
        const val PARAM_VERSION = &quot;version&quot;
        const val PARAM_VERSIONS = &quot;versions&quot;
        const val PARAM_VIDEOS = &quot;videos&quot;
        const val PARAM_WANT = &quot;want&quot;
        const val PARAM_WANT_PARTS = &quot;wantparts&quot;
        const val PARAM_WANT_TO_BUY = &quot;wanttobuy&quot;
        const val PARAM_WANT_TO_PLAY = &quot;wanttoplay&quot;
        const val PARAM_WISHLIST = &quot;wishlist&quot;
        const val PARAM_WISHLIST_PRIORITY = &quot;wishlistpriority&quot;

        @JvmStatic
        fun main(args: Array&lt;String&gt;) {
<span class="nc" id="L94">            Napier.base(DebugAntilog())</span>

<span class="nc" id="L96">            val client = BggClient()</span>
<span class="nc" id="L97">            runBlocking {</span>
<span class="nc" id="L98">                val response =</span>
<span class="nc" id="L99">                    client.collection(</span>
<span class="nc" id="L100">                        &quot;Novaeux&quot;,</span>
<span class="nc" id="L101">                        ThingType.BOARD_GAME,</span>
<span class="nc" id="L102">                        stats = true,</span>
                    )
                //                    client.things(
                //                        ids = arrayOf(224517),
                //                        types = arrayOf(ThingType.BOARD_GAME),
                //                        marketplace = true,
                //                        ratingComments = true,
                //                        videos = true,
                //                        versions = true,
                //                        stats = true,
                //                    )

<span class="nc" id="L114">                Napier.i(</span>
                    &quot;&quot;&quot;
<span class="nc" id="L116">                    ${response}</span>
                    
                    &quot;&quot;&quot;
<span class="nc" id="L119">                        .trimIndent()</span>
                )
<span class="nc" id="L121">            }</span>

<span class="nc" id="L123">            client.close()</span>
<span class="nc" id="L124">        }</span>
    }
}

<span class="nc" id="L128">class BggRequestException(message: String) : Exception(message)</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>