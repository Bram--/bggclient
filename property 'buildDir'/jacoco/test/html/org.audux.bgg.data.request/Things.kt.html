<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Things.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">BggClient</a> &gt; <a href="index.source.html" class="el_package">org.audux.bgg.data.request</a> &gt; <span class="el_source">Things.kt</span></div><h1>Things.kt</h1><pre class="source lang-java linenums">/**
 * Copyright 2023 Bram Wijnands
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */
package org.audux.bgg.data.request

import io.ktor.client.request.get
import io.ktor.client.statement.bodyAsText
import io.ktor.http.appendPathSegments
import io.ktor.util.StringValues
import org.audux.bgg.BggClient
import org.audux.bgg.BggRequestException
import org.audux.bgg.data.common.ThingType
import org.audux.bgg.data.response.Things

/**
 * Request a Thing or list of things. Multiple things can be requested by passing in several IDs. At
 * least one ID is required to make this request. Sending along [types] might result in an empty as
 * the API filters based on the [ThingType].
 */
<span class="nc" id="L30">suspend fun BggClient.things(</span>
    /**
     * Specifies the id of the thing(s) to retrieve. To request multiple things with a single query,
     * can specify a comma-delimited list of ids.
     */
    ids: Array&lt;Int&gt;,

    /**
     * Specifies that, regardless of the type of thing asked for by id, the results are filtered by
     * the THINGTYPE(s) specified. Multiple THINGTYPEs can be specified in a comma-delimited list.
     * Leave empty to return all types.
     *
     * @see ThingType
     */
    types: Array&lt;ThingType&gt; = arrayOf(),

    /** Returns ranking and rating stats for the thing. */
<span class="nc" id="L47">    stats: Boolean = false,</span>

    /** Returns version info for the thing. */
<span class="nc" id="L50">    versions: Boolean = false,</span>

    /** Returns videos for the thing. */
<span class="nc" id="L53">    videos: Boolean = false,</span>

    /** Returns marketplace data. */
<span class="nc" id="L56">    marketplace: Boolean = false,</span>

    /**
     * Returns all comments about the thing. Also includes ratings when commented. See page
     * parameter.
     */
<span class="nc" id="L62">    comments: Boolean = false,</span>

    /**
     * Returns all ratings for the thing. Also includes comments when rated. See page parameter. The
     * [ratingComments] and [comments] parameters cannot be used together, as the output always
     * appears in the &lt;comments&gt; node of the XML; comments parameter takes precedence if both are
     * specified.
     *
     * Ratings are sorted in descending rating value, based on the highest rating they have assigned
     * to that thing (each thing in the collection can have a different rating).
     */
<span class="nc" id="L73">    ratingComments: Boolean = false,</span>

    /** Defaults to 1, controls the page of data to see for comments, and ratings data. */
<span class="nc" id="L76">    page: Int = 0,</span>

    /**
     * Set the number of records to return in paging. Minimum is 10, maximum is 100. Defaults to 100
     */
<span class="nc" id="L81">    pageSize: Int = 0,</span>
): Things {
<span class="nc bnc" id="L83" title="All 4 branches missed.">    if (page != 0 &amp;&amp; !(10..100).contains(pageSize)) {</span>
<span class="nc" id="L84">        throw BggRequestException(&quot;pageSize must be between 10 and 100&quot;)</span>
    }
<span class="nc bnc" id="L86" title="All 4 branches missed.">    if (comments &amp;&amp; ratingComments) {</span>
<span class="nc" id="L87">        throw BggRequestException(&quot;comments and ratingsComments can't both be true.&quot;)</span>
    }

<span class="nc" id="L90">    val response =</span>
<span class="nc" id="L91">        client.get(BggClient.BASE_URL) {</span>
<span class="nc bnc" id="L92" title="All 12 branches missed.">            url {</span>
<span class="nc" id="L93">                appendPathSegments(BggClient.PATH_THING)</span>

<span class="nc" id="L95">                parameters.appendAll(</span>
<span class="nc" id="L96">                    StringValues.build {</span>
<span class="nc" id="L97">                        append(BggClient.PARAM_ID, ids.joinToString(&quot;,&quot;))</span>

<span class="nc bnc" id="L99" title="All 6 branches missed.">                        if (types.isNotEmpty()) {</span>
<span class="nc" id="L100">                            append(BggClient.PARAM_TYPE, types.joinToString { &quot;${it.param},&quot; })</span>
                        }

<span class="nc bnc" id="L103" title="All 2 branches missed.">                        if (stats) append(BggClient.PARAM_STATS, &quot;1&quot;)</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">                        if (versions) append(BggClient.PARAM_VERSIONS, &quot;1&quot;)</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">                        if (videos) append(BggClient.PARAM_VIDEOS, &quot;1&quot;)</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">                        if (marketplace) append(BggClient.PARAM_MARKETPLACE, &quot;1&quot;)</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">                        if (comments) append(BggClient.PARAM_COMMENTS, &quot;1&quot;)</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">                        if (ratingComments) append(BggClient.PARAM_RATING_COMMENTS, &quot;1&quot;)</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">                        if (page &gt; 0) append(BggClient.PARAM_PAGE, page.toString())</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">                        if (pageSize &gt; 0) append(BggClient.PARAM_PAGE_SIZE, pageSize.toString())</span>
<span class="nc" id="L111">                    }</span>
                )
<span class="nc" id="L113">            }</span>
<span class="nc" id="L114">        }</span>

<span class="nc" id="L116">    return mapper.readValue(response.bodyAsText(), Things::class.java)</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>